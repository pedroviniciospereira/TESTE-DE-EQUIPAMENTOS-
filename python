from flask import Flask, render_template, request, redirect, url_for, flash
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config["SQLALCHEMY_DATABASE_URI"] = "sqlite:///equipamentos.db"
db = SQLAlchemy(app)

class Equipamento(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    nome = db.Column(db.String(100), nullable=False)
    descricao = db.Column(db.String(200), nullable=False)

@app.route("/")
def index():
    equipamentos = Equipamento.query.all()
    return render_template("index.html", equipamentos=equipamentos)

@app.route("/cadastrar", methods=["GET", "POST"])
def cadastrar():
    if request.method == "POST":
        nome = request.form["nome"]
        descricao = request.form["descricao"]
        equipamento = Equipamento(nome=nome, descricao=descricao)
        db.session.add(equipamento)
        try:
            db.session.commit()
            flash("Equipamento cadastrado com sucesso!", "success")
        except Exception as e:
            flash("Erro ao cadastrar equipamento!", "danger")
    return render_template("cadastrar.html")

@app.route("/editar/<int:id>", methods=["GET", "POST"])
def editar(id):
    equipamento = Equipamento.query.get(id)
    if request.method == "POST":
        equipamento.nome = request.form["nome"]
        equipamento.descricao = request.form["descricao"]
        try:
            db.session.commit()
            flash("Equipamento atualizado com sucesso!", "success")
        except Exception as e:
            flash("Erro ao atualizar equipamento!", "danger")
    return render_template("editar.html", equipamento=equipamento)

@app.route("/excluir/<int:id>", methods=["POST"])
def excluir(id):
    equipamento = Equipamento.query.get(id)
    if equipamento:
        try:
            db.session.delete(equipamento)
            db.session.commit()
            flash("Equipamento exclu√≠do com sucesso!", "success")
        except Exception as e:
            flash("Erro ao excluir equipamento!", "danger")
    return redirect(url_for("index"))

if __name__ == "__main__":
    app.run(debug=True)